{
  "annotations": { "list": [] },
  "editable": true,
  "title": "FastFood - Order Service Deep Dive",
  "tags": ["orderservice", "otel", "demo"],
  "panels": [
    { "type": "row", "title": "Order Flow KPIs", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 } },
    { "type": "stat", "title": "Orders Created / min", "targets": [ { "expr": "sum(rate(orderservice_orders_created_total[5m])) * 60", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 } },
    { "type": "stat", "title": "Orders Paid / min", "targets": [ { "expr": "sum(rate(orderservice_orders_paid_total[5m])) * 60", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 } },
    { "type": "gauge", "title": "Conversion %", "fieldConfig": { "defaults": { "unit": "percent", "min": 0, "max": 100 } }, "targets": [ { "expr": "(sum(rate(orderservice_orders_paid_total[5m])) / sum(rate(orderservice_orders_created_total[5m]))) * 100", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 6, "w": 6, "x": 12, "y": 1 } },

    { "type": "row", "title": "Order Value & Items", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 } },
    { "type": "timeseries", "title": "Items per Order (p50, p95)", "targets": [
      { "expr": "histogram_quantile(0.50, sum by (le) (rate(orderservice_orders_item_count_items_bucket[5m])))", "refId": "A", "legendFormat": "p50", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } },
      { "expr": "histogram_quantile(0.95, sum by (le) (rate(orderservice_orders_item_count_items_bucket[5m])))", "refId": "B", "legendFormat": "p95", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } }
    ], "gridPos": { "h": 7, "w": 12, "x": 0, "y": 8 } },

    { "type": "row", "title": "Durations (seconds)", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 15 } },
    { "type": "timeseries", "title": "Sales Duration p95", "fieldConfig": { "defaults": { "unit": "s" } }, "targets": [ { "expr": "histogram_quantile(0.95, sum by (le) (rate(orderservice_orders_sales_duration_milliseconds_seconds_bucket[5m])))", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 8, "w": 8, "x": 0, "y": 16 } },
    { "type": "timeseries", "title": "Preparation Duration p95", "fieldConfig": { "defaults": { "unit": "s" } }, "targets": [ { "expr": "histogram_quantile(0.95, sum by (le) (rate(orderservice_orders_preparation_duration_milliseconds_seconds_bucket[5m])))", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 8, "w": 8, "x": 8, "y": 16 } },

    { "type": "row", "title": "HTTP Performance", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 24 } },
    { "type": "timeseries", "title": "p95 by Route (top5)", "targets": [ { "expr": "topk(5, histogram_quantile(0.95, sum by (http_route, le) (rate(http_server_request_duration_seconds_bucket{service=\"orderservice\"}[5m]))))", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 8, "w": 12, "x": 0, "y": 25 } },
    { "type": "gauge", "title": "Error rate % (5xx)", "fieldConfig": { "defaults": { "unit": "percent", "min": 0, "max": 100 } }, "targets": [ { "expr": "(sum(rate(http_server_request_duration_seconds_count{service=\"orderservice\", http_response_status_code=~\"5..\"}[5m])) / sum(rate(http_server_request_duration_seconds_count{service=\"orderservice\"}[5m]))) * 100", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 8, "w": 6, "x": 12, "y": 25 } },
    { "type": "stat", "title": "RPS", "targets": [ { "expr": "sum(rate(http_server_request_duration_seconds_count{service=\"orderservice\"}[5m]))", "refId": "A", "datasource": { "type": "prometheus", "uid": "prometheus-metrics" } } ], "gridPos": { "h": 8, "w": 6, "x": 18, "y": 25 } },

  { "type": "row", "title": "Logs", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 33 } },
  { "type": "logs", "title": "OrderService Errors (Loki)", "targets": [ { "expr": "{service_name=\\\"OrderService\\\"} | detected_level=~\\\"(Error|Critical|Fatal)\\\"", "refId": "A", "datasource": { "type": "loki", "uid": "loki-logs" } } ], "gridPos": { "h": 8, "w": 24, "x": 0, "y": 34 } }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "style": "dark",
  "time": { "from": "now-1h", "to": "now" },
  "version": 1
}
